#!/usr/bin/env python3
"""
Master Audit Script - Run All Checks
=====================================
Runs all audit tools in sequence to check data availability.

Usage:
    python run_full_audit.py
"""

import subprocess
import sys
from pathlib import Path

def run_command(cmd, description):
    """Run a command and capture output"""
    print("\n" + "="*80)
    print(f"  {description}")
    print("="*80 + "\n")
    
    try:
        result = subprocess.run(
            cmd,
            shell=True,
            capture_output=True,
            text=True
        )
        
        print(result.stdout)
        if result.stderr:
            print("STDERR:", result.stderr)
        
        return result.returncode == 0
    except Exception as e:
        print(f"âœ— Error: {e}")
        return False

def main():
    """Run full audit sequence"""
    print("="*80)
    print("  FULL DATA AUDIT - All Countries")
    print("  Checking: USA, Canada, UK, Japan")
    print("="*80)
    
    # Step 1: Check existing data
    print("\n[STEP 1] Checking existing CSV files...")
    success1 = run_command(
        "python audit_existing_data.py",
        "Auditing Existing Data Files"
    )
    
    # Step 2: Show what's needed
    print("\n[STEP 2] Showing what we need to find...")
    success2 = run_command(
        "python quick_reference.py",
        "Quick Reference - Known vs Missing"
    )
    
    # Step 3: Search FRED
    print("\n[STEP 3] Searching FRED for missing indicators...")
    print("This may take 2-3 minutes...\n")
    success3 = run_command(
        "python fred_series_finder_all_countries.py",
        "FRED Series Search"
    )
    
    # Summary
    print("\n" + "="*80)
    print("  AUDIT COMPLETE")
    print("="*80)
    
    if success1 and success2 and success3:
        print("\n[+] All checks completed successfully")
    else:
        print("\n[!] Some checks failed - review output above")
    
    print("\nNext Steps:")
    print("  1. Review the output above")
    print("  2. Note which FRED codes were found")
    print("  3. Update download_historical_data.py with found codes")
    print("  4. For missing codes:")
    print("     - Check central bank websites directly")
    print("     - Consider using proxy indicators")
    print("     - Document what's unavailable")
    
    print("\n" + "="*80)

if __name__ == '__main__':
    # Check if required files exist
    required = [
        'audit_existing_data.py',
        'quick_reference.py',
        'fred_series_finder_all_countries.py'
    ]
    
    missing = [f for f in required if not Path(f).exists()]
    
    if missing:
        print("[X] Missing required files:")
        for f in missing:
            print(f"  - {f}")
        print("\nMake sure all files are in the same directory")
        sys.exit(1)
    
    main()